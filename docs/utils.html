<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>couchdb3.utils API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>couchdb3.utils</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import base64
from collections.abc import Generator
import re
import requests
from typing import Any, Dict, Optional, Set
from urllib import parse

from . import exceptions


__all__ = [
    &#34;basic_auth&#34;,
    &#34;build_query&#34;,
    &#34;build_url&#34;,
    &#34;validate_db_name&#34;,
    &#34;validate_proxy&#34;,
    &#34;validate_user_id&#34;,
    &#34;check_response&#34;,
    &#34;content_type_getter&#34;,
    &#34;extract_url_data&#34;,
    &#34;COUCHDB_USERS_DB_NAME&#34;,
    &#34;COUCHDB_REPLICATOR_DB_NAME&#34;,
    &#34;COUCHDB_GLOBAL_CHANGES_DB_NAME&#34;,
    &#34;COUCH_DB_RESERVED_DB_NAMES&#34;,
    &#34;DEFAULT_TIMEOUT&#34;,
    &#34;MIME_TYPES_MAPPING&#34;,
    &#34;PATTERN_DB_NAME&#34;,
    &#34;PATTERN_USER_ID&#34;,
    &#34;PATTERN_URL&#34;,
]


COUCHDB_USERS_DB_NAME: str = &#34;_users&#34;
&#34;&#34;&#34;Reserved CouchDB users database name.&#34;&#34;&#34;
COUCHDB_REPLICATOR_DB_NAME: str = &#34;_replicator&#34;
&#34;&#34;&#34;Reserved CouchDB replicator database name.&#34;&#34;&#34;
COUCHDB_GLOBAL_CHANGES_DB_NAME: str = &#34;_global_changes&#34;
&#34;&#34;&#34;Reserved CouchDB global changes database name.&#34;&#34;&#34;

COUCH_DB_RESERVED_DB_NAMES: Set[str] = {
    COUCHDB_USERS_DB_NAME,
    COUCHDB_REPLICATOR_DB_NAME,
    COUCHDB_GLOBAL_CHANGES_DB_NAME
}
&#34;&#34;&#34;Reserved CouchDB database names.&#34;&#34;&#34;

DEFAULT_TEXTUAL_MIME_TYPE: str = &#34;text/plain&#34;
DEFAULT_FALLBACK_MIME_TYPE: str = &#34;application/octet-stream&#34;
DEFAULT_TIMEOUT: int = 15
&#34;&#34;&#34;The default timeout set in requests.&#34;&#34;&#34;

MIME_TYPES_MAPPING: Dict = {
    &#34;aac&#34;: &#34;audio/aac&#34;,
    &#34;abw&#34;: &#34;application/x-abiword&#34;,
    &#34;arc&#34;: &#34;application/x-freearc&#34;,
    &#34;avi&#34;: &#34;video/x-msvideo&#34;,
    &#34;azw&#34;: &#34;application/vnd.amazon.ebook&#34;,
    &#34;bin&#34;: &#34;application/octet-stream&#34;,
    &#34;bmp&#34;: &#34;image/bmp&#34;,
    &#34;bz&#34;: &#34;application/x-bzip&#34;,
    &#34;bz2&#34;: &#34;application/x-bzip2&#34;,
    &#34;cda&#34;: &#34;application/x-cdf&#34;,
    &#34;csh&#34;: &#34;application/x-csh&#34;,
    &#34;css&#34;: &#34;text/css&#34;,
    &#34;csv&#34;: &#34;text/csv&#34;,
    &#34;doc&#34;: &#34;application/msword&#34;,
    &#34;docx&#34;: &#34;application/vnd.openxmlformats-officedocument.wordprocessingml.document&#34;,
    &#34;eot&#34;: &#34;application/vnd.ms-fontobject&#34;,
    &#34;epub&#34;: &#34;application/epub+zip&#34;,
    &#34;gz&#34;: &#34;application/gzip&#34;,
    &#34;gif&#34;: &#34;image/gif&#34;,
    &#34;htm&#34;: &#34;text/html&#34;,
    &#34;html&#34;: &#34;text/html&#34;,
    &#34;ico&#34;: &#34;image/vnd.microsoft.icon&#34;,
    &#34;ics&#34;: &#34;text/calendar&#34;,
    &#34;jar&#34;: &#34;application/java-archive&#34;,
    &#34;jpeg&#34;: &#34;image/jpeg&#34;,
    &#34;jpg&#34;: &#34;image/jpeg&#34;,
    &#34;js&#34;: &#34;text/javascript&#34;,
    &#34;json&#34;: &#34;application/json&#34;,
    &#34;jsonld&#34;: &#34;application/ld+json&#34;,
    &#34;mid&#34;: &#34;audio/midi audio/x-midi&#34;,
    &#34;midi&#34;: &#34;audio/midi audio/x-midi&#34;,
    &#34;mjs&#34;: &#34;text/javascript&#34;,
    &#34;mp3&#34;: &#34;audio/mpeg&#34;,
    &#34;mp4&#34;: &#34;video/mp4&#34;,
    &#34;mpeg&#34;: &#34;video/mpeg&#34;,
    &#34;mpkg&#34;: &#34;application/vnd.apple.installer+xml&#34;,
    &#34;odp&#34;: &#34;application/vnd.oasis.opendocument.presentation&#34;,
    &#34;ods&#34;: &#34;application/vnd.oasis.opendocument.spreadsheet&#34;,
    &#34;odt&#34;: &#34;application/vnd.oasis.opendocument.text&#34;,
    &#34;oga&#34;: &#34;audio/ogg&#34;,
    &#34;ogv&#34;: &#34;video/ogg&#34;,
    &#34;ogx&#34;: &#34;application/ogg&#34;,
    &#34;opus&#34;: &#34;audio/opus&#34;,
    &#34;otf&#34;: &#34;font/otf&#34;,
    &#34;png&#34;: &#34;image/png&#34;,
    &#34;pdf&#34;: &#34;application/pdf&#34;,
    &#34;php&#34;: &#34;application/x-httpd-php&#34;,
    &#34;ppt&#34;: &#34;application/vnd.ms-powerpoint&#34;,
    &#34;pptx&#34;: &#34;application/vnd.openxmlformats-officedocument.presentationml.presentation&#34;,
    &#34;rar&#34;: &#34;application/vnd.rar&#34;,
    &#34;rtf&#34;: &#34;application/rtf&#34;,
    &#34;sh&#34;: &#34;application/x-sh&#34;,
    &#34;svg&#34;: &#34;image/svg+xml&#34;,
    &#34;swf&#34;: &#34;application/x-shockwave-flash&#34;,
    &#34;tar&#34;: &#34;application/x-tar&#34;,
    &#34;tif .tiff&#34;: &#34;image/tiff&#34;,
    &#34;ts&#34;: &#34;video/mp2t&#34;,
    &#34;ttf&#34;: &#34;font/ttf&#34;,
    &#34;txt&#34;: &#34;text/plain&#34;,
    &#34;vsd&#34;: &#34;application/vnd.visio&#34;,
    &#34;wav&#34;: &#34;audio/wav&#34;,
    &#34;weba&#34;: &#34;audio/webm&#34;,
    &#34;webm&#34;: &#34;video/webm&#34;,
    &#34;webp&#34;: &#34;image/webp&#34;,
    &#34;woff&#34;: &#34;font/woff&#34;,
    &#34;woff2&#34;: &#34;font/woff2&#34;,
    &#34;xhtml&#34;: &#34;application/xhtml+xml&#34;,
    &#34;xls&#34;: &#34;application/vnd.ms-excel&#34;,
    &#34;xlsx&#34;: &#34;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#34;,
    &#34;xml&#34;: &#34;application/xml&#34;,
    &#34;xul&#34;: &#34;application/vnd.mozilla.xul+xml&#34;,
    &#34;zip&#34;: &#34;application/zip&#34;,
    &#34;3gp&#34;: &#34;video/3gpp&#34;,
    &#34;3g2&#34;: &#34;video/3gpp2&#34;,
    &#34;7z&#34;: &#34;application/x-7z-compressed&#34;
}
&#34;&#34;&#34;A dictionary mapping file extensions to their appropriate content-type.&#34;&#34;&#34;

PATTERN_DB_NAME: re.Pattern = re.compile(r&#34;^[a-z][a-z0-9_$()+/-]*$&#34;)
&#34;&#34;&#34;The pattern for valid database names.&#34;&#34;&#34;
PATTERN_USER_ID: re.Pattern = re.compile(r&#34;^org\.couchdb\.user:.*&#34;)
&#34;&#34;&#34;The pattern for valid user IDs.&#34;&#34;&#34;
PATTERN_URL: re.Pattern = re.compile(r&#34;^(\w+)://((.*):(.*)@|)(\w[\w.-]+\w)(:(\d+)|)/?(.*)$&#34;)
&#34;&#34;&#34;A pattern for abstract URLs split as `scheme://user:password@host:port/path`.&#34;&#34;&#34;


def _handler(x: Any) -&gt; str:
    if isinstance(x, (Generator, list, set, tuple)):
        return &#34;[%s]&#34; % &#34;,&#34;.join(f&#34;\&#34;{_handler(_)}\&#34;&#34; for _ in x)
    elif isinstance(x, dict):
        return str({key: _handler(val) for key, val in x.items()})
    elif isinstance(x, bool):
        return str(x).lower()
    return str(x)


def basic_auth(
        user: str,
        password: str
) -&gt; str:
    &#34;&#34;&#34;
    Create basic authentication headers value.

    Parameters
    ----------
    user : str
        A CouchDB user name.
    password : str
        A corresponding CouchDB user password.

    Returns
    -------
    str : The credentials concatenated with a colon and base64 encoded.
    &#34;&#34;&#34;
    return base64.b64encode(f&#34;{user}:{password}&#34;.encode()).decode()


def build_query(
        **kwargs,
) -&gt; Optional[str]:
    &#34;&#34;&#34;

    Parameters
    ----------
    kwargs
        Arbitrary keyword-args to be passed as query-params in a URL.
    Returns
    -------
    str : A string containing the keyword-args encoded as URL query-params.
    &#34;&#34;&#34;
    return parse.urlencode({key: _handler(val) for key, val in kwargs.items() if val is not None})


def build_url(
        *,
        scheme: str,
        host: str,
        path: str = None,
        port: int = None,
        **kwargs,
) -&gt; str:
    &#34;&#34;&#34;
    Build a URL using the provided scheme, host, path &amp; kwargs.

    Parameters
    ----------
    scheme : str
        The URL scheme (e.g `http`).
    host : str
        The URL host (e.g. `example.com`).
    path : str
        The URL path (e.g. `/api/data`). Default `None`.
    port : int
        The port to connect to (e.g. `5984`). Default `None`.
    kwargs
        Arbitrary keyword-args to be passed as query-params in a URL.
    Returns
    -------
    str : A URL parsed as string.
    &#34;&#34;&#34;
    url = f&#34;{scheme}://{host}&#34;
    if port:
        url += f&#34;:{port}&#34;
    if path:
        path = path.removeprefix(&#34;/&#34;)
        url += f&#34;/{path}&#34;
    if kwargs:
        url += f&#34;?{build_query(**kwargs)}&#34;
    return url


def validate_db_name(name: str) -&gt; bool:
    &#34;&#34;&#34;
    Checks a name for CouchDB name-compliance.

    Parameters
    ----------
    name : str
        A prospective database name.

    Returns
    -------
    bool : `True` if the provided name is CouchDB compliant.
    &#34;&#34;&#34;
    return name in COUCH_DB_RESERVED_DB_NAMES or bool(PATTERN_DB_NAME.fullmatch(name))


def validate_proxy(proxy: str) -&gt; bool:
    &#34;&#34;&#34;
    Check a proxy scheme for CouchDB proxy-scheme-compliance

    Parameters
    ----------
    proxy : str
        A prospective proxy.

    Returns
    -------
    bool : `True` if the provided proxy is CouchDB compliant.
    &#34;&#34;&#34;
    return PATTERN_URL.sub(r&#34;\1&#34;, proxy) in {&#34;http&#34;, &#34;socks5&#34;}


def validate_user_id(user_id: str) -&gt; bool:
    &#34;&#34;&#34;
    Checks a user ID for CouchDB user-id-compliance.

    Parameters
    ----------
    user_id : str
        A prospective user ID.

    Returns
    -------
    bool : `True` if the provided user ID is CouchDB compliant.

    &#34;&#34;&#34;
    return bool(PATTERN_USER_ID.fullmatch(user_id))


def check_response(response: requests.Response) -&gt; None:
    &#34;&#34;&#34;
    Check if a request yields a successful response.

    Parameters
    ----------
    response : requests.Response
        A `requests.Response` object.
    Returns
    -------
    None
    Raises
    ------
    One of the following exceptions:

    - couchdb3.error.CouchDBError
    - ConnectionError
    - TimeoutError
    - requests.exceptions.ConnectionError
    - requests.exceptions.HTTPError

    &#34;&#34;&#34;
    try:
        response.raise_for_status()
    except (
            ConnectionError,
            TimeoutError,
            requests.exceptions.ConnectionError,
            requests.exceptions.HTTPError,
    ) as err:
        if response.status_code in exceptions.STATUS_CODE_ERROR_MAPPING:
            _ = exceptions.STATUS_CODE_ERROR_MAPPING[response.status_code]
            if _:
                raise _(response.text)
            else:
                return None
        raise err


def content_type_getter(
        file_name: str = None,
        data: Any = None
) -&gt; Optional[str]:
    &#34;&#34;&#34;
    Get the appropriate content-type.

    If the argument `file_name` is provided, the content-type will be determined by matching the file extension against
    keys of `MIME_TYPES_MAPPING`. If no match was found, then `&#34;application/octet-stream&#34;` will be returned.

    Alternatively, if the argument `data` is provided the conent-type returned will be

    - `&#34;application/json&#34;` if `data` is a dictionary or a list
    - `&#34;text/plain&#34;` else

    Parameters
    ----------
    file_name : str
        A file name.
    data : Any
        A Python object.

    Returns
    -------
    str : A valid content-type.
    &#34;&#34;&#34;
    if file_name:
        for ext, mime_type in MIME_TYPES_MAPPING.items():
            if file_name.endswith(f&#34;.{ext}&#34;):
                return mime_type
        return DEFAULT_FALLBACK_MIME_TYPE
    elif data:
        if isinstance(data, (dict, list)):
            return &#34;application/json&#34;
        else:
            return DEFAULT_TEXTUAL_MIME_TYPE


def extract_url_data(url: str) -&gt; Dict:
    &#34;&#34;&#34;
    Extract scheme, credentials, host, port &amp; path from a URL.

    Parameters
    ----------
    url : str
        A URL string.

    Returns
    -------
    Dict : A dictionary containing with the following items.

      - scheme
      - user
      - password
      - host
      - port
      - path
    &#34;&#34;&#34;
    return {
        &#34;scheme&#34;: PATTERN_URL.sub(r&#34;\1&#34;, url) or None,
        &#34;user&#34;: PATTERN_URL.sub(r&#34;\3&#34;, url) or None,
        &#34;password&#34;: PATTERN_URL.sub(r&#34;\4&#34;, url) or None,
        &#34;host&#34;: PATTERN_URL.sub(r&#34;\5&#34;, url) or None,
        &#34;port&#34;: int(PATTERN_URL.sub(r&#34;\7&#34;, url) or 0) or None,
        &#34;path&#34;: PATTERN_URL.sub(r&#34;\8&#34;, url or None)
    }</code></pre>
</details>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-variables">Global variables</h2>
<dl>
<dt id="couchdb3.utils.COUCHDB_GLOBAL_CHANGES_DB_NAME"><code class="name">var <span class="ident">COUCHDB_GLOBAL_CHANGES_DB_NAME</span> : str</code></dt>
<dd>
<div class="desc"><p>Reserved CouchDB global changes database name.</p></div>
</dd>
<dt id="couchdb3.utils.COUCHDB_REPLICATOR_DB_NAME"><code class="name">var <span class="ident">COUCHDB_REPLICATOR_DB_NAME</span> : str</code></dt>
<dd>
<div class="desc"><p>Reserved CouchDB replicator database name.</p></div>
</dd>
<dt id="couchdb3.utils.COUCHDB_USERS_DB_NAME"><code class="name">var <span class="ident">COUCHDB_USERS_DB_NAME</span> : str</code></dt>
<dd>
<div class="desc"><p>Reserved CouchDB users database name.</p></div>
</dd>
<dt id="couchdb3.utils.COUCH_DB_RESERVED_DB_NAMES"><code class="name">var <span class="ident">COUCH_DB_RESERVED_DB_NAMES</span> : Set[str]</code></dt>
<dd>
<div class="desc"><p>Reserved CouchDB database names.</p></div>
</dd>
<dt id="couchdb3.utils.DEFAULT_TIMEOUT"><code class="name">var <span class="ident">DEFAULT_TIMEOUT</span> : int</code></dt>
<dd>
<div class="desc"><p>The default timeout set in requests.</p></div>
</dd>
<dt id="couchdb3.utils.MIME_TYPES_MAPPING"><code class="name">var <span class="ident">MIME_TYPES_MAPPING</span> : Dict</code></dt>
<dd>
<div class="desc"><p>A dictionary mapping file extensions to their appropriate content-type.</p></div>
</dd>
<dt id="couchdb3.utils.PATTERN_DB_NAME"><code class="name">var <span class="ident">PATTERN_DB_NAME</span> : re.Pattern</code></dt>
<dd>
<div class="desc"><p>The pattern for valid database names.</p></div>
</dd>
<dt id="couchdb3.utils.PATTERN_URL"><code class="name">var <span class="ident">PATTERN_URL</span> : re.Pattern</code></dt>
<dd>
<div class="desc"><p>A pattern for abstract URLs split as <code>scheme://user:password@host:port/path</code>.</p></div>
</dd>
<dt id="couchdb3.utils.PATTERN_USER_ID"><code class="name">var <span class="ident">PATTERN_USER_ID</span> : re.Pattern</code></dt>
<dd>
<div class="desc"><p>The pattern for valid user IDs.</p></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="couchdb3.utils.basic_auth"><code class="name flex">
<span>def <span class="ident">basic_auth</span></span>(<span>user: str, password: str) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Create basic authentication headers value.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>user</code></strong> :&ensp;<code>str</code></dt>
<dd>A CouchDB user name.</dd>
<dt><strong><code>password</code></strong> :&ensp;<code>str</code></dt>
<dd>A corresponding CouchDB user password.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>str : The credentials concatenated with a colon and base64 encoded.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def basic_auth(
        user: str,
        password: str
) -&gt; str:
    &#34;&#34;&#34;
    Create basic authentication headers value.

    Parameters
    ----------
    user : str
        A CouchDB user name.
    password : str
        A corresponding CouchDB user password.

    Returns
    -------
    str : The credentials concatenated with a colon and base64 encoded.
    &#34;&#34;&#34;
    return base64.b64encode(f&#34;{user}:{password}&#34;.encode()).decode()</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.build_query"><code class="name flex">
<span>def <span class="ident">build_query</span></span>(<span>**kwargs) ‑> Optional[str]</span>
</code></dt>
<dd>
<div class="desc"><h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>kwargs</code></strong></dt>
<dd>Arbitrary keyword-args to be passed as query-params in a URL.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>str : A string containing the keyword-args encoded as URL query-params.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def build_query(
        **kwargs,
) -&gt; Optional[str]:
    &#34;&#34;&#34;

    Parameters
    ----------
    kwargs
        Arbitrary keyword-args to be passed as query-params in a URL.
    Returns
    -------
    str : A string containing the keyword-args encoded as URL query-params.
    &#34;&#34;&#34;
    return parse.urlencode({key: _handler(val) for key, val in kwargs.items() if val is not None})</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.build_url"><code class="name flex">
<span>def <span class="ident">build_url</span></span>(<span>*, scheme: str, host: str, path: str = None, port: int = None, **kwargs) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Build a URL using the provided scheme, host, path &amp; kwargs.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>scheme</code></strong> :&ensp;<code>str</code></dt>
<dd>The URL scheme (e.g <code>http</code>).</dd>
<dt><strong><code>host</code></strong> :&ensp;<code>str</code></dt>
<dd>The URL host (e.g. <code>example.com</code>).</dd>
<dt><strong><code>path</code></strong> :&ensp;<code>str</code></dt>
<dd>The URL path (e.g. <code>/api/data</code>). Default <code>None</code>.</dd>
<dt><strong><code>port</code></strong> :&ensp;<code>int</code></dt>
<dd>The port to connect to (e.g. <code>5984</code>). Default <code>None</code>.</dd>
<dt><strong><code>kwargs</code></strong></dt>
<dd>Arbitrary keyword-args to be passed as query-params in a URL.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>str : A URL parsed as string.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def build_url(
        *,
        scheme: str,
        host: str,
        path: str = None,
        port: int = None,
        **kwargs,
) -&gt; str:
    &#34;&#34;&#34;
    Build a URL using the provided scheme, host, path &amp; kwargs.

    Parameters
    ----------
    scheme : str
        The URL scheme (e.g `http`).
    host : str
        The URL host (e.g. `example.com`).
    path : str
        The URL path (e.g. `/api/data`). Default `None`.
    port : int
        The port to connect to (e.g. `5984`). Default `None`.
    kwargs
        Arbitrary keyword-args to be passed as query-params in a URL.
    Returns
    -------
    str : A URL parsed as string.
    &#34;&#34;&#34;
    url = f&#34;{scheme}://{host}&#34;
    if port:
        url += f&#34;:{port}&#34;
    if path:
        path = path.removeprefix(&#34;/&#34;)
        url += f&#34;/{path}&#34;
    if kwargs:
        url += f&#34;?{build_query(**kwargs)}&#34;
    return url</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.check_response"><code class="name flex">
<span>def <span class="ident">check_response</span></span>(<span>response: requests.models.Response) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Check if a request yields a successful response.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>response</code></strong> :&ensp;<code>requests.Response</code></dt>
<dd>A <code>requests.Response</code> object.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>None</code></dt>
<dd>&nbsp;</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>One</code> of <code>the following exceptions:</code></dt>
<dd>&nbsp;</dd>
</dl>
<ul>
<li>couchdb3.error.CouchDBError</li>
<li>ConnectionError</li>
<li>TimeoutError</li>
<li>requests.exceptions.ConnectionError</li>
<li>requests.exceptions.HTTPError</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_response(response: requests.Response) -&gt; None:
    &#34;&#34;&#34;
    Check if a request yields a successful response.

    Parameters
    ----------
    response : requests.Response
        A `requests.Response` object.
    Returns
    -------
    None
    Raises
    ------
    One of the following exceptions:

    - couchdb3.error.CouchDBError
    - ConnectionError
    - TimeoutError
    - requests.exceptions.ConnectionError
    - requests.exceptions.HTTPError

    &#34;&#34;&#34;
    try:
        response.raise_for_status()
    except (
            ConnectionError,
            TimeoutError,
            requests.exceptions.ConnectionError,
            requests.exceptions.HTTPError,
    ) as err:
        if response.status_code in exceptions.STATUS_CODE_ERROR_MAPPING:
            _ = exceptions.STATUS_CODE_ERROR_MAPPING[response.status_code]
            if _:
                raise _(response.text)
            else:
                return None
        raise err</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.content_type_getter"><code class="name flex">
<span>def <span class="ident">content_type_getter</span></span>(<span>file_name: str = None, data: Any = None) ‑> Optional[str]</span>
</code></dt>
<dd>
<div class="desc"><p>Get the appropriate content-type.</p>
<p>If the argument <code>file_name</code> is provided, the content-type will be determined by matching the file extension against
keys of <code><a title="couchdb3.utils.MIME_TYPES_MAPPING" href="#couchdb3.utils.MIME_TYPES_MAPPING">MIME_TYPES_MAPPING</a></code>. If no match was found, then <code>"application/octet-stream"</code> will be returned.</p>
<p>Alternatively, if the argument <code>data</code> is provided the conent-type returned will be</p>
<ul>
<li><code>"application/json"</code> if <code>data</code> is a dictionary or a list</li>
<li><code>"text/plain"</code> else</li>
</ul>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>file_name</code></strong> :&ensp;<code>str</code></dt>
<dd>A file name.</dd>
<dt><strong><code>data</code></strong> :&ensp;<code>Any</code></dt>
<dd>A Python object.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>str : A valid content-type.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def content_type_getter(
        file_name: str = None,
        data: Any = None
) -&gt; Optional[str]:
    &#34;&#34;&#34;
    Get the appropriate content-type.

    If the argument `file_name` is provided, the content-type will be determined by matching the file extension against
    keys of `MIME_TYPES_MAPPING`. If no match was found, then `&#34;application/octet-stream&#34;` will be returned.

    Alternatively, if the argument `data` is provided the conent-type returned will be

    - `&#34;application/json&#34;` if `data` is a dictionary or a list
    - `&#34;text/plain&#34;` else

    Parameters
    ----------
    file_name : str
        A file name.
    data : Any
        A Python object.

    Returns
    -------
    str : A valid content-type.
    &#34;&#34;&#34;
    if file_name:
        for ext, mime_type in MIME_TYPES_MAPPING.items():
            if file_name.endswith(f&#34;.{ext}&#34;):
                return mime_type
        return DEFAULT_FALLBACK_MIME_TYPE
    elif data:
        if isinstance(data, (dict, list)):
            return &#34;application/json&#34;
        else:
            return DEFAULT_TEXTUAL_MIME_TYPE</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.extract_url_data"><code class="name flex">
<span>def <span class="ident">extract_url_data</span></span>(<span>url: str) ‑> Dict</span>
</code></dt>
<dd>
<div class="desc"><p>Extract scheme, credentials, host, port &amp; path from a URL.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>url</code></strong> :&ensp;<code>str</code></dt>
<dd>A URL string.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Dict : A dictionary containing with the following items.</p>
<ul>
<li>scheme</li>
<li>user</li>
<li>password</li>
<li>host</li>
<li>port</li>
<li>path</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def extract_url_data(url: str) -&gt; Dict:
    &#34;&#34;&#34;
    Extract scheme, credentials, host, port &amp; path from a URL.

    Parameters
    ----------
    url : str
        A URL string.

    Returns
    -------
    Dict : A dictionary containing with the following items.

      - scheme
      - user
      - password
      - host
      - port
      - path
    &#34;&#34;&#34;
    return {
        &#34;scheme&#34;: PATTERN_URL.sub(r&#34;\1&#34;, url) or None,
        &#34;user&#34;: PATTERN_URL.sub(r&#34;\3&#34;, url) or None,
        &#34;password&#34;: PATTERN_URL.sub(r&#34;\4&#34;, url) or None,
        &#34;host&#34;: PATTERN_URL.sub(r&#34;\5&#34;, url) or None,
        &#34;port&#34;: int(PATTERN_URL.sub(r&#34;\7&#34;, url) or 0) or None,
        &#34;path&#34;: PATTERN_URL.sub(r&#34;\8&#34;, url or None)
    }</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.validate_db_name"><code class="name flex">
<span>def <span class="ident">validate_db_name</span></span>(<span>name: str) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Checks a name for CouchDB name-compliance.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code></dt>
<dd>A prospective database name.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>bool : <code>True</code> if the provided name is CouchDB compliant.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def validate_db_name(name: str) -&gt; bool:
    &#34;&#34;&#34;
    Checks a name for CouchDB name-compliance.

    Parameters
    ----------
    name : str
        A prospective database name.

    Returns
    -------
    bool : `True` if the provided name is CouchDB compliant.
    &#34;&#34;&#34;
    return name in COUCH_DB_RESERVED_DB_NAMES or bool(PATTERN_DB_NAME.fullmatch(name))</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.validate_proxy"><code class="name flex">
<span>def <span class="ident">validate_proxy</span></span>(<span>proxy: str) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Check a proxy scheme for CouchDB proxy-scheme-compliance</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>proxy</code></strong> :&ensp;<code>str</code></dt>
<dd>A prospective proxy.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>bool : <code>True</code> if the provided proxy is CouchDB compliant.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def validate_proxy(proxy: str) -&gt; bool:
    &#34;&#34;&#34;
    Check a proxy scheme for CouchDB proxy-scheme-compliance

    Parameters
    ----------
    proxy : str
        A prospective proxy.

    Returns
    -------
    bool : `True` if the provided proxy is CouchDB compliant.
    &#34;&#34;&#34;
    return PATTERN_URL.sub(r&#34;\1&#34;, proxy) in {&#34;http&#34;, &#34;socks5&#34;}</code></pre>
</details>
</dd>
<dt id="couchdb3.utils.validate_user_id"><code class="name flex">
<span>def <span class="ident">validate_user_id</span></span>(<span>user_id: str) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Checks a user ID for CouchDB user-id-compliance.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>user_id</code></strong> :&ensp;<code>str</code></dt>
<dd>A prospective user ID.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>bool : <code>True</code> if the provided user ID is CouchDB compliant.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def validate_user_id(user_id: str) -&gt; bool:
    &#34;&#34;&#34;
    Checks a user ID for CouchDB user-id-compliance.

    Parameters
    ----------
    user_id : str
        A prospective user ID.

    Returns
    -------
    bool : `True` if the provided user ID is CouchDB compliant.

    &#34;&#34;&#34;
    return bool(PATTERN_USER_ID.fullmatch(user_id))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="couchdb3" href="index.html">couchdb3</a></code></li>
</ul>
</li>
<li><h3><a href="#header-variables">Global variables</a></h3>
<ul class="">
<li><code><a title="couchdb3.utils.COUCHDB_GLOBAL_CHANGES_DB_NAME" href="#couchdb3.utils.COUCHDB_GLOBAL_CHANGES_DB_NAME">COUCHDB_GLOBAL_CHANGES_DB_NAME</a></code></li>
<li><code><a title="couchdb3.utils.COUCHDB_REPLICATOR_DB_NAME" href="#couchdb3.utils.COUCHDB_REPLICATOR_DB_NAME">COUCHDB_REPLICATOR_DB_NAME</a></code></li>
<li><code><a title="couchdb3.utils.COUCHDB_USERS_DB_NAME" href="#couchdb3.utils.COUCHDB_USERS_DB_NAME">COUCHDB_USERS_DB_NAME</a></code></li>
<li><code><a title="couchdb3.utils.COUCH_DB_RESERVED_DB_NAMES" href="#couchdb3.utils.COUCH_DB_RESERVED_DB_NAMES">COUCH_DB_RESERVED_DB_NAMES</a></code></li>
<li><code><a title="couchdb3.utils.DEFAULT_TIMEOUT" href="#couchdb3.utils.DEFAULT_TIMEOUT">DEFAULT_TIMEOUT</a></code></li>
<li><code><a title="couchdb3.utils.MIME_TYPES_MAPPING" href="#couchdb3.utils.MIME_TYPES_MAPPING">MIME_TYPES_MAPPING</a></code></li>
<li><code><a title="couchdb3.utils.PATTERN_DB_NAME" href="#couchdb3.utils.PATTERN_DB_NAME">PATTERN_DB_NAME</a></code></li>
<li><code><a title="couchdb3.utils.PATTERN_URL" href="#couchdb3.utils.PATTERN_URL">PATTERN_URL</a></code></li>
<li><code><a title="couchdb3.utils.PATTERN_USER_ID" href="#couchdb3.utils.PATTERN_USER_ID">PATTERN_USER_ID</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="couchdb3.utils.basic_auth" href="#couchdb3.utils.basic_auth">basic_auth</a></code></li>
<li><code><a title="couchdb3.utils.build_query" href="#couchdb3.utils.build_query">build_query</a></code></li>
<li><code><a title="couchdb3.utils.build_url" href="#couchdb3.utils.build_url">build_url</a></code></li>
<li><code><a title="couchdb3.utils.check_response" href="#couchdb3.utils.check_response">check_response</a></code></li>
<li><code><a title="couchdb3.utils.content_type_getter" href="#couchdb3.utils.content_type_getter">content_type_getter</a></code></li>
<li><code><a title="couchdb3.utils.extract_url_data" href="#couchdb3.utils.extract_url_data">extract_url_data</a></code></li>
<li><code><a title="couchdb3.utils.validate_db_name" href="#couchdb3.utils.validate_db_name">validate_db_name</a></code></li>
<li><code><a title="couchdb3.utils.validate_proxy" href="#couchdb3.utils.validate_proxy">validate_proxy</a></code></li>
<li><code><a title="couchdb3.utils.validate_user_id" href="#couchdb3.utils.validate_user_id">validate_user_id</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>